### 백엔드 서버 구축 요구사항 (v1.1)

#### 1. 목표 (Goal)

-   기존 프론트엔드 애플리케이션의 데이터 영속성 계층을 `localStorage`에서 백엔드 API 서버로 교체한다.
-   이를 통해 데이터 관리 로직을 프론트엔드와 분리하고, 향후 데이터베이스 확장 가능성을 마련한다.

#### 2. 기술 스택 (Tech Stack)

-   **런타임:** Node.js
-   **웹 프레임워크:** Express.js
-   **데이터 저장소:** JSON 파일 (`db.json`)
-   **개발 편의 도구:**
    -   `nodemon`: 소스 코드 변경 시 자동으로 서버를 재시작해주는 도구.
    -   `cors`: 프론트엔드 개발 서버로부터의 API 요청을 허용하기 위한 미들웨어.

#### 3. 데이터 저장소 설계 (Data Storage Design)

-   **데이터 파일:** 프로젝트 루트의 `db.json` 파일에 모든 데이터를 JSON 형식으로 저장한다.
-   **파일 구조:** `todos` 배열과 `settings` 객체를 포함한다.
    ```json
    {
      "todos": [],
      "settings": { "theme": "light" }
    }
    ```
-   **데이터 저장 프로세스 (원자적 쓰기):**
    -   **[중요]** 데이터 무결성을 보장하기 위해, 모든 파일 쓰기 작업은 **'원자적 쓰기(Atomic Write)'** 패턴을 따라야 한다.
    -   **프로세스:**
        1.  데이터 변경 시, 새로운 전체 내용을 임시 파일(예: `db.json.tmp`)에 먼저 쓴다.
        2.  임시 파일 쓰기가 성공적으로 완료되면, `rename` 작업을 통해 임시 파일의 이름을 원본 파일(`db.json`) 이름으로 변경하여 데이터를 덮어쓴다.
    -   **기대 효과:** 이 방식은 파일 쓰기 도중 시스템이 중단(BSOD, 정전 등)되더라도 원본 데이터의 손상을 방지한다.

#### 4. API 엔드포인트 명세 (API Endpoint Specification)

##### 4.1. 할 일 (Todos) API

| 기능             | HTTP Method | 경로 (Path)              | 설명                                       |
| ---------------- | ----------- | ------------------------ | ------------------------------------------ |
| 모든 할 일 조회  | `GET`       | `/api/todos`             | 모든 할 일 목록을 조회합니다.              |
| 새 할 일 추가    | `POST`      | `/api/todos`             | 새로운 할 일을 추가합니다.                 |
| 특정 할 일 수정  | `PUT`       | `/api/todos/:id`         | 특정 할 일의 전체 정보를 수정합니다.       |
| 할 일 상태 변경  | `PATCH`     | `/api/todos/:id/status`  | 특정 할 일의 `status`만 변경합니다.        |
| 깃발 상태 토글   | `PATCH`     | `/api/todos/:id/toggle`  | 특정 할 일의 `flagged` 상태를 토글합니다.  |
| 할 일 삭제       | `DELETE`    | `/api/todos/:id`         | 특정 할 일을 삭제합니다.                   |

##### 4.2. 설정 (Settings) API

| 기능       | HTTP Method | 경로 (Path)         | 설명                       |
| ---------- | ----------- | ------------------- | -------------------------- |
| 테마 조회  | `GET`       | `/api/settings/theme` | 현재 테마 설정을 조회합니다. |
| 테마 업데이트 | `PUT`       | `/api/settings/theme` | 테마 설정을 업데이트합니다.  |

#### 5. 비기능적 요구사항 (Non-functional Requirements)

-   **데이터 무결성 (Data Integrity):** 예기치 않은 시스템 중단 시에도 데이터 파일(`db.json`)이 손상되지 않아야 한다. (3번 항목의 '원자적 쓰기'를 통해 보장)
-   **개발 환경:**
    -   **실행 환경:** 사용자 PC (Windows 10)의 Node.js 환경.
    -   **서버 포트:** `3001` 또는 프론트엔드와 겹치지 않는 다른 포트를 사용한다.
    -   **자동 재시작:** `nodemon`을 사용하여 개발 중 코드 변경 시 서버가 자동으로 다시 시작되어야 한다.
